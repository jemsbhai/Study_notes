#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass article
\begin_preamble
\usepackage{amsthm}% http://ctan.org/pkg/amsthm
\usepackage{amssymb}% http://ctan.org/pkg/amssymb
\usepackage{amsmath}
\end_preamble
\use_default_options true
\begin_modules
knitr
\end_modules
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_amsmath 1
\use_esint 1
\use_mhchem 1
\use_mathdots 1
\cite_engine basic
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\leftmargin 2.5cm
\topmargin 2cm
\rightmargin 2.5cm
\bottommargin 2cm
\headheight 2cm
\headsep 2cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation 0bp
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\align center

\series bold
PH 1918 Longitudinal Data Analysis--HW1
\end_layout

\begin_layout Standard
\align center
Ming Yang
\end_layout

\begin_layout Enumerate

\series bold
Standard quality control investigations on 
\emph on
weight
\emph default
 and 
\emph on
age
\emph default
.
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<boxplots,out.width="0.5
\backslash

\backslash
maxwidth",echo=T,fig.show='hold'>>=
\end_layout

\begin_layout Plain Layout

#load datasets
\end_layout

\begin_layout Plain Layout

wtdata<-dget("wtdata.Rdata")
\end_layout

\begin_layout Plain Layout

widedata<-dget("widedata.Rdata")
\end_layout

\begin_layout Plain Layout

plot(wtdata[["age"]],wtdata[["wt"]],ylab="weight",xlab="age")
\end_layout

\begin_layout Plain Layout

boxplot(wtdata[["wt"]],ylab="weight")
\end_layout

\begin_layout Plain Layout

#found outlier values 88.8 and 99.9, should be coded as missing values
\end_layout

\begin_layout Plain Layout

#remove outlier and redo plot
\end_layout

\begin_layout Plain Layout

boxplot(wtdata[["wt"]][!wtdata$wt%in%c(99.9,88.8)],ylab="weight")
\end_layout

\begin_layout Plain Layout

boxplot(wtdata[["age"]],ylab="age")
\end_layout

\begin_layout Plain Layout

# not implausible values for age
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate

\series bold
Structure of the data set
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<>>=
\end_layout

\begin_layout Plain Layout

dim(wtdata)
\end_layout

\begin_layout Plain Layout

# there are 1000 observations and 19 variables (it shows 21 variables since
 I've created 2 additional variables when working on the problems.)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# a list of the variables
\end_layout

\begin_layout Plain Layout

names(wtdata)
\end_layout

\begin_layout Plain Layout

# baseline variables: id, sex, bf, mage, lit, died, alive
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# time-varying variables: wt, ht, arm, bf, day, month, year
\end_layout

\begin_layout Plain Layout

table(wtdata[["id"]])[1:10]
\end_layout

\begin_layout Plain Layout

table(wtdata[["t2"]])
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The original study design is balanced (each subject has five observations)
 and approximately equal-spaced (around 4 month apart.), however due to the
 missing values, the resulting data is not balanced.
\end_layout

\end_deeper
\begin_layout Enumerate

\series bold
Plot weight against age and splines (R)
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<wt_age,out.width="0.8
\backslash

\backslash
maxwidth">>=
\end_layout

\begin_layout Plain Layout

wt_subdata<-subset(wtdata,!wtdata[["wt"]]%in%c(99.9,88.8))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

# fit linear regression model and get the predictions as lm_fitted
\end_layout

\begin_layout Plain Layout

lm_fit<-lm(wt_subdata[["wt"]]~wt_subdata[["age"]])
\end_layout

\begin_layout Plain Layout

lm_fitted<-lm_fit$fitted.values
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

lim<-quantile(wt_subdata[["age"]],c(.33,.67)) 
\end_layout

\begin_layout Plain Layout

library(splines) 
\end_layout

\begin_layout Plain Layout

lspline_fit<-lm(wt~bs(age,knots=lim,degree=1),data=wt_subdata) 
\end_layout

\begin_layout Plain Layout

cspline_fit<-lm(wt~bs(age,knots=lim,degree=3),data=wt_subdata) 
\end_layout

\begin_layout Plain Layout

age<-seq(1,76,length.out=200)
\end_layout

\begin_layout Plain Layout

plot(wt_subdata[["age"]],wt_subdata[["wt"]],xlab="age",ylab="weight",cex=0.4,pch=
19,col="blue")
\end_layout

\begin_layout Plain Layout

abline(lm_fit,lty=1,col="red",lwd=2)
\end_layout

\begin_layout Plain Layout

lines(age,predict(lspline_fit,data.frame(age=age)),col="black",lty=1,lwd=3)
\end_layout

\begin_layout Plain Layout

lines(age,predict(cspline_fit,data.frame(age=age)),col="green",lty=1,lwd=2)
\end_layout

\begin_layout Plain Layout

legend("topleft",c("lm","linear spline","cubic spline"),col=c("red","black","gre
en"),lty=c(1,1,1))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% latex table generated in R 3.0.2 by xtable 1.7-1 package % Thu Feb  6 22:00:16
 2014 
\end_layout

\begin_layout Plain Layout


\backslash
begin{table}[ht] 
\backslash
caption{summary table of model fitted based on OLS}
\end_layout

\begin_layout Plain Layout


\backslash
centering 
\backslash
begin{tabular}{rrrrr}   
\backslash
hline  & Estimate & Std.
 Error & t value & Pr($>$$|$t$|$) 
\backslash

\backslash
    
\backslash
hline (Intercept) & 5.8762 & 0.1091 & 53.87 & 0.0000 
\backslash

\backslash
    age & 0.1398 & 0.0026 & 54.14 & 0.0000 
\backslash

\backslash
     
\backslash
hline 
\backslash
end{tabular} 
\end_layout

\begin_layout Plain Layout


\backslash
end{table} 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% latex table generated in R 3.0.2 by xtable 1.7-1 package % Tue Feb 18 10:06:03
 2014 
\end_layout

\begin_layout Plain Layout


\backslash
begin{table}[ht]
\backslash
caption{summary table of model fitted based on linear spline} 
\backslash
centering 
\backslash
begin{tabular}{rrrrr}   
\backslash
hline  & Estimate & Std.
 Error & t value & Pr($>$$|$t$|$) 
\backslash

\backslash
    
\backslash
hline (Intercept) & 5.1605 & 0.2060 & 25.06 & 0.0000 
\backslash

\backslash
    age & 0.1731 & 0.0100 & 17.33 & 0.0000 
\backslash

\backslash
    age27 & -0.0251 & 0.0160 & -1.57 & 0.1176 
\backslash

\backslash
    age48 & -0.0498 & 0.0154 & -3.23 & 0.0013 
\backslash

\backslash
     
\backslash
hline 
\backslash
end{tabular} 
\end_layout

\begin_layout Plain Layout


\backslash
end{table} 
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

% latex table generated in R 3.0.2 by xtable 1.7-1 package % Tue Feb 18 10:06:58
 2014 
\end_layout

\begin_layout Plain Layout


\backslash
begin{table}[ht] 
\backslash
caption{summary table of model fitted based on cubic spline}
\backslash
centering 
\backslash
begin{tabular}{rrrrr}   
\backslash
hline  & Estimate & Std.
 Error & t value & Pr($>$$|$t$|$) 
\backslash

\backslash
    
\backslash
hline (Intercept) & 4.4744 & 0.4970 & 9.00 & 0.0000 
\backslash

\backslash
    age & 0.3036 & 0.0875 & 3.47 & 0.0005 
\backslash

\backslash
    age
\backslash
_sq & -0.0064 & 0.0045 & -1.42 & 0.1549 
\backslash

\backslash
    age
\backslash
_cb & 0.0001 & 0.0001 & 1.28 & 0.1996 
\backslash

\backslash
    age27
\backslash
_cb & -0.0001 & 0.0001 & -1.30 & 0.1947 
\backslash

\backslash
    age48
\backslash
_cb & 0.0001 & 0.0001 & 0.78 & 0.4328 
\backslash

\backslash
     
\backslash
hline 
\backslash
end{tabular}
\end_layout

\begin_layout Plain Layout


\backslash
end{table} 
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
The linear regression is fitted based on the ordinary least square (OLS)
 estimates, the model assumes iid in the random errors and calculates the
 fitted value by minimizing the residuals.
 The coefficients of the linear regression stands for the effects from the
 change of corresponding covariates on the outcome.
 Here we can see one month increase in age will lead to around 0.14 kg increase
 in the weight (p-value 0.000 ).
\end_layout

\begin_layout Enumerate
Linear spline (order=1) with two knots are essentially three segments of
 straight lines connected at the two knots.
 Cubic spline (order=3) with two knots is similar as linear spline but the
 three segments divided by the two knots are not linear lines but polynomial
 functions (here are cubic polynomials), thus smooth curves.
\end_layout

\begin_layout Enumerate
By observing the three curves, we can see the two splines are close to each
 other with some divergence at two ends.
 So we prefer to use linear spline, which is simpler to implement but efficient.
\end_layout

\end_deeper
\begin_layout Enumerate

\series bold
Scatterplot matrix and ACF (grouped time) (R and STATA)
\end_layout

\begin_deeper
\begin_layout Standard
By observing the distribution of the time variable 
\begin_inset ERT
status open

\begin_layout Plain Layout

$t2$
\end_layout

\end_inset

 we can combine the value of 7-9 as one time category, and combine 12 and
 13, 15 and 17, 19 and 21, 23 to 25 together respectively.
 Then we will generate a new time variable with 5 time points, and each
 has 200 observations.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<matrixplot,out.width="0.5
\backslash

\backslash
maxwidth",warning=F,fig.show="hold">>=
\end_layout

\begin_layout Plain Layout

wdata_com<-dget("widedata_com.Rdata")
\end_layout

\begin_layout Plain Layout

ldata_com<-dget("longdata_com.Rdata")
\end_layout

\begin_layout Plain Layout

require(graphics)
\end_layout

\begin_layout Plain Layout

pairs(~.,data=wdata_com[,-6],main="Simple Scatterplot Matrix")
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

acfs<-c(.93144,.90152,.8761476,.86075)
\end_layout

\begin_layout Plain Layout

tau<-c(1:4)
\end_layout

\begin_layout Plain Layout

acf_data<-data.frame(acf=acfs,tau=tau) 
\end_layout

\begin_layout Plain Layout

N<-c(165+167+167+152,172+165+153,166+150,153)
\end_layout

\begin_layout Plain Layout

lag<-c(1:4)
\end_layout

\begin_layout Plain Layout

se<-1/sqrt(N)
\end_layout

\begin_layout Plain Layout

lb<-acfs-2*se;ub<-acfs+2*se
\end_layout

\begin_layout Plain Layout

for (i in 1:4){if (ub[i]>1) ub[i]<-1}
\end_layout

\begin_layout Plain Layout

plot(tau,acfs,ylab="acf",ylim=c(0,1.5),pch=19,main="ACF plot with CI")
\end_layout

\begin_layout Plain Layout

points(tau,lb,col="blue",pch=18)
\end_layout

\begin_layout Plain Layout

points(tau,ub,col="blue",pch=18)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename ../../../Dropbox/StudyDocuments/PH1918-Correlated Outcome Data/Hws/HW1/autocor.png
	display false
	scale 80

\end_inset


\begin_inset Graphics
	filename ../../../Dropbox/StudyDocuments/PH1918-Correlated Outcome Data/Hws/HW1/pwcorr.png
	display false
	scale 50

\end_inset


\end_layout

\begin_layout Standard
As can be seen from the plots and table:
\end_layout

\begin_layout Enumerate
All the residuals from different lags are positively correlated.
 In general, the autocorrelations decrease wth lag increases slightly (not
 easy to tell from the plot matrix) based on the numerical value in last
 table as well as in the ACF plot.
\end_layout

\begin_layout Enumerate
The CI for ACF increases as time lag increases since the se increases with
 time lage.
\end_layout

\end_deeper
\begin_layout Enumerate

\series bold
Variogram and ACF plot based on variogram (STATA)
\end_layout

\begin_deeper
\begin_layout Standard
\align center
\begin_inset Graphics
	filename ../../../Dropbox/StudyDocuments/PH1918-Correlated Outcome Data/Hws/HW1/variogram.pdf
	lyxscale 20
	scale 70

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename ../../../Dropbox/StudyDocuments/PH1918-Correlated Outcome Data/Hws/HW1/varioacf.pdf
	lyxscale 20
	scale 70

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
[Y_{877
\backslash
times 1}=X_{877
\backslash
times 2}
\backslash
cdot
\backslash
beta_{2
\backslash
times 1}+
\backslash
varepsilon_{877
\backslash
times 1}
\backslash
]
\end_layout

\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
where
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
[Y=
\backslash
begin{pmatrix}Y_1
\backslash

\backslash
Y_2
\backslash

\backslash

\backslash
vdots
\backslash

\backslash
Y_i
\backslash

\backslash

\backslash
vdots
\backslash

\backslash
Y_{197}
\backslash
end{pmatrix}_{877
\backslash
times 1}
\end_layout

\begin_layout Plain Layout

X=
\backslash
begin{pmatrix}X_1
\backslash

\backslash
X_2
\backslash

\backslash

\backslash
vdots
\backslash

\backslash
X_i
\backslash

\backslash

\backslash
vdots
\backslash

\backslash
X_{197}
\backslash
end{pmatrix}_{877
\backslash
times 2}
\end_layout

\begin_layout Plain Layout


\backslash
varepsilon=
\backslash
begin{pmatrix}
\backslash
varepsilon_1
\backslash

\backslash

\backslash
varepsilon_2
\backslash

\backslash

\backslash
vdots
\backslash

\backslash

\backslash
varepsilon_i
\backslash

\backslash

\backslash
vdots
\backslash

\backslash

\backslash
varepsilon_{197}
\backslash
end{pmatrix}_{877
\backslash
times 1}
\end_layout

\begin_layout Plain Layout

Y_i=
\backslash
begin{pmatrix}y_{i1}
\backslash

\backslash
y_{i2}
\backslash

\backslash

\backslash
vdots
\backslash

\backslash
y_{in_i}
\backslash
end{pmatrix}_{n_i
\backslash
times 1}
\end_layout

\begin_layout Plain Layout

X_i=
\backslash
begin{pmatrix}1&x_{i1}
\backslash

\backslash
1&x_{i2}
\backslash

\backslash

\backslash
vdots
\backslash

\backslash
1&x_{in_i}
\backslash
end{pmatrix}_{n_i
\backslash
times 2}
\end_layout

\begin_layout Plain Layout


\backslash
]
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset ERT
status open

\begin_layout Plain Layout

$Cov(
\backslash
varepsilon_{i})$
\end_layout

\end_inset

=
\begin_inset Formula $\sigma^{2}\mathbf{I}_{n_{i}\times n_{i}}$
\end_inset

 for independence model
\end_layout

\begin_layout Itemize
\begin_inset Formula $Cov(\mathbf{\varepsilon}_{i})=\sigma^{2}\mathbf{I}_{n_{i}\times n_{i}}+\sigma^{2}\rho(\mathbf{J}_{n_{i}\times n_{i}}-\mathbf{I}_{n_{i}\times n_{i}})$
\end_inset

 for uniform correlation model.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

% latex table generated in R 3.0.2 by xtable 1.7-1 package % Thu Feb  6 22:00:16
 2014 
\end_layout

\begin_layout Plain Layout


\backslash
begin{table}[ht] 
\backslash
caption{summary table of model fitted based on OLS}
\end_layout

\begin_layout Plain Layout


\backslash
centering 
\backslash
begin{tabular}{rrrrr}   
\backslash
hline  & Estimate & Std.
 Error & t value & Pr($>$$|$t$|$) 
\backslash

\backslash
    
\backslash
hline (Intercept) & 5.8762 & 0.1091 & 53.87 & 0.0000 
\backslash

\backslash
    age & 0.1398 & 0.0026 & 54.14 & 0.0000 
\backslash

\backslash
     
\backslash
hline 
\backslash
end{tabular} 
\end_layout

\begin_layout Plain Layout


\backslash
end{table} 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{table}[ht] 
\backslash
caption{summary table of model fitted based on WLS}
\backslash
centering 
\backslash
begin{tabular}{rrrrr}   
\backslash
hline  & Estimate & Std.
 Error & t value & Pr($>$$|$t$|$) 
\backslash

\backslash
    
\backslash
hline (Intercept) & 6.0327 & 0.1341 & 44.99 & 0.0000 
\backslash

\backslash
    age & 0.1352 & 0.0024 & 55.49 & 0.0000 
\backslash

\backslash
     
\backslash
hline 
\backslash
end{tabular} 
\end_layout

\begin_layout Plain Layout


\backslash
end{table} 
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
Results from two model fitting are listed in above tables.
 The results are close to each other.
 one month increase in age will result in 0.140 kg increase in the weight
 based on the results from OLS fit and 0.135 kg increase in weight based
 on the results from WLS fit.
 Both results are significant.
 
\end_layout

\begin_layout Enumerate
In this question the WLS method should be more appropriate.
 WLS model accounts for the correlations among repeated measures within
 the same subject, while in the OLS we just ignor these correlations, which
 is more real for the data we are analysing.
\end_layout

\begin_layout Enumerate
The compound symmetry structure assumes the correlations for repeated measures
 within the subject are all equal, which may not be appropritate since we
 see a decreasing autocrrelation in the data.
 A more appropriate covariance structure can be AR(1).
\end_layout

\end_deeper
\begin_layout Enumerate

\series bold
Proof
\series default
:
\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{eqnarray*}Cov(a_1Y_1,a_2Y_2)&=&E(a_1Y_1a_2Y_2)-E(a_1Y_1)E(a_2Y_2)
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

&=&a_1a_2E(Y_1Y_2)-a_1a_2E(Y_1)E(Y_2)
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

&=&a_1a_2[E(Y_1Y2)-E(Y_1)E(Y_2)]
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

&=&a_1a_2Cov(Y_1,Y_2)
\end_layout

\begin_layout Plain Layout


\backslash
end{eqnarray*}
\end_layout

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
The OLS estimate of 
\begin_inset Formula $\mathbf{\beta}$
\end_inset

 is given by 
\begin_inset Formula $\hat{{\beta}}=\mathbf{(X'X)^{-1}X'y}$
\end_inset

 , 
\end_layout

\begin_deeper
\begin_layout Standard
thus 
\begin_inset Formula $E(\hat{{\beta})}=\mathbf{E[(X'X)^{-1}X'y]}=\mathbf{(X'X)^{-1}X'E(y)=(X'X)^{-1}X'X\beta=\beta}$
\end_inset

.
 The OLS estimate of 
\begin_inset ERT
status open

\begin_layout Plain Layout

$
\backslash
beta$
\end_layout

\end_inset

 is unbiased.
\end_layout

\end_deeper
\end_body
\end_document
